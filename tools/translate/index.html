<!DOCTYPE html>
<html>
	<head>
		<title>Page Title</title>
	<script src=https://nguyenthanh1995.github.io/my.js></script>
	<script src=https://nguyenthanh1995.github.io/lib/XML.js></script>
	<script src=https://nguyenthanh1995.github.io/lib/vue.min.js></script>
	<link rel=stylesheet href=https://nguyenthanh1995.github.io/css/bootstrap.min.css></link>
        <link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css ></link>
	<meta name=viewport content='width=device-width, user-scalable=no, initial-scale=1.0' charset=utf-8 />
	</head>
	<body>
	
<nav id=menu-header class="navbar navbar-expand-lg navbar-light bg-light">
	<a class="navbar-brand" href="https://nguyenthanh1995.github.io">
		<img class="img-fluid mr-1" style="width: 2em; height: 2em" src=https://nguyenthanh1995.github.io/CydiaIcon.png />
		N.t Repo
	</a>
	<button class="navbar-toggler menu-btn">
		<span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link" href="/index.html">
	<i class="far mr-1 fa-home"></i>
	Home (Repo)
	<!--<span class="sr-only">(current)</span>-->
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/jailbreak-tool">
	<i class="far mr-1 fa-tools"></i>
	Jailbreak Tools
				</a>
			</li>
			<li class="nav-item active dropdown">
				<a class="nav-link dropdown-toggle">
	<i class="fas mr-1 fa-toolbox"></i>
	Tools
				</a>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="/tools/translate">
	<i class="far mr-1 active fa-language"></i>
	Translate Tool
					</a>
		  			<a class="dropdown-item" href="/tools/mterminal-theme">
	<i class="far mr-1 fa-terminal"></i>
	MTerminal Theme Manager
					</a>
		  			<div class="dropdown-divider"></div>
		  			<a class="dropdown-item" href="#">Something else here</a>
				</div>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/about.html">
	<i class="far mr-1 fa-info-circle"></i>
	About
				</a>
			</li>
		</ul><!--
		<form class="form-inline my-2 my-lg-0">
			<input class="form-control mr-sm-2" label="Search">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
		</form>-->
		<hr class="my-1">
		<div class="my-2 my-lg-0">
			<a target=_blank href="https://www.facebook.com/profile.php?id=100024588752208" class="social"><i class="fab fa-facebook-square"></i></a>
			<a target=_blank href="https://twitter.com/NguyenThanhDev" class="social"><i class="fab fa-twitter"></i></a>
			<a target=_blank href="https://www.instagram.com/thanh6454nguyen/" class="social"><i class="fab fa-instagram"></i></a>
			<!--<i class="fab fa-facebook-messenger social"></i>-->
			<a target=_blank href="https://github.com/nguyenthanh1995" class="social"><i class="fab fa-github"></i></a>
			<a target=_blank href="mailto:thanhnguyennguyen1995@gmail.com" class="social"><i class="far fa-envelope"></i></a>
		</div>
	</div>
</nav>
<style type=text/css>
.social {
	font-size: 150%;
	margin-right: .1em;
	color: initial;
}
.social:hover, .social:active {
	color: initial;
}
#menu-header .social:last-child {
	margin-right: auto;
}

.navbar-dark .social > i {
	color: #f8f9fa;
}

</style>
<script>
my.fn.collapse = function () {

my(this).click(function () {
	var isShow = my(this).next()
					.hasClass("show")
	my(this).next()
	.removeClass("collapse")
	.addClass("collapsing")
	.height(
		isShow ? 0 : my(this).next()[0].scrollHeight
	)
	.one(my.fx.transitionEnd)
	.then(function () {
		my(this)
		.removeClass("collapsing")
		.addClass("collapse")
		my(this)[(isShow ? "remove" : "add") + "Class"]("show")
	})
})

}
my(".menu-btn").collapse()

my(".dropdown-toggle")
.click(function () {
	my(this).next()
	.toggleClass("show")
})

/*
if (localStorage.getItem("theme") === "dark")
	my("#menu-header")
	.removeClass("navbar-light bg-light")
	.addClass("navbar-dark bg-dark")
function toggleThemeMenu () {
	my("#menu-header")
	.toggleClass("navbar-light bg-light navbar-dark bg-dark")
}*/
</script>

		<div class=container>
			<div class=row>
				<div class=col>
					<h3 class="text-center">
						Simple Tool Translate Plist XML
					</h3>
				</div>
			</div>
			<div class=row>
				<div class=col>
					<h6 class="text-left text-secondary text-uppercase">
						Mode
					</h6>
					<div class="btn-group btn-group-sm">
						<button class="btn btn-outline-dark" :class="{active: mode === 'XML'}" @click="mode = 'XML'">Plist | XML</button>
						<button class="btn btn-outline-dark" :class="{active: mode === 'Localizable'}" @click="mode = 'Localizable'">Localizable</button>
					</div>
					<div class="small text-secondary mt-2">Nếu ứng dụng bị treo 0% hãy thử đổi chế độ và thử lại.</div>
				</div>
			</div>
			<div class=row>
				<div class="col-12 col-lg-6">
					<h6 class="text-left text-secondary text-uppercase">
						Language
					</h6>
					<div class="input-group input-group-sm">
						<select class="input-group custom-select" v-model=from>
							<option v-for="val in language" :value=val.code :label=val.name>{{ val.name }} ({{ val.nativeName }})</option>
						</select>
						<div class="input-group-append">
							<span class="input-group-text">to</span>
						</div>
						<select class="input-group custom-select" v-model=to>
							<option v-for="val in language" :value=val.code :label=val.name>{{ val.name }} ({{ val.nativeName }})</option>
						</select>
					</div>
				</div>
				<div class="col mt-3 mt-lg-0">
					<div class="input-group input-group-sm">
						<textarea class="form-control" rows=12 placeholder="Content file plist" v-model=textContent></textarea>
					</div>
					<div class="small text-secondary my-2 text-center">or</div>
					<div class="input-group input-group-sm">
						<div class=custom-file>
							<input type=file class=custom-file-input @change=loadFile($event.target.files[0]) />
							<label class=custom-file-label accept=*/(?:plist|xml)>Choose file</label>
						</div>
					</div> 
				</div>
				<div class="col-12 col-lg-5 mt-3 mt-lg-0">
					<div :hidden=translating class="progress mb-3" id=transing>
						<div class="progress-bar progress-bar-striped progress-bar-animated" :style="{width: progress + '%'}">{{ ~~progress }}%</div>
					</div>
					<button class="btn btn-outline-primary btn-sm btn-block" @click=translate>Translate</button>
				</div>
			</div>
			<div :hidden=!translated class=row>
				<div class="col mt-3 mt-lg-0">
					<h6 class="text-left text-secondary text-uppercase">
						Result
					</h6>
					<div class="input-group input-group-sm">
						<textarea class="form-control" rows=12 placeholder="Content file plist" :value=result></textarea>
					</div>
				</div>
			</div>
		</div>
<style>
* {
	margin: 0;
	padding: 0;
}
body {
	
}
.container > .row:not(*[class*="mb"], *[class="mt"]) {
	margin-bottom: 1rem;
}
/*
	my-\d: margin top and bottom
*/

</style>
<script>

var success = {}, globalXML, plistHeader = '<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">'
var keyAPI = "trnsl.1.1.20190805T120232Z.0523a6991fcd184f.75d91c8953614377173228e9fc61b57678c66d4e";
var language = JSON.parse(my.getText("https://dl.dropboxusercontent.com/s/ze5hyst321ei1se/lang.json?raw=1"))[0]

console.error = console.warn = e => console.log(e + '')

var container = new Vue({
	el: ".container",
	data: {
		language: language,
		from: "en",
		to: "vi",
		textContent: "",
		translating: true,
		progress: 0,
		translated: false,
		result: "",
		mode: "XML"
	},
	watch: {
		translated: function (n) {
			if (n === true)
				if (this.mode === "XML")
					this.result = plistHeader + "\n" + XML.stringify(globalXML)
				else this.result = globalXML.join("\n") + '\n'
		}
	},
	methods: {
		translate: function () {
			this.translating = false
			if (this.mode === "XML")
			 	globalXML = XML.parse(this.textContent)
			else globalXML = my.trim(this.textContent).split("\n")
			 void translateXML()
		},
		loadFile: function (file) {
			var _ = this
			 my(new FileReader)
			 .load(function () {
				 _.textContent = decodeURIComponent(this.result)
			 })[0]
			 .readAsText(file, "UTF-8")
		}
	}
})

function translateXML () {
	if (container.mode === "XML")
		my(globalXML).find("dict")
		.find("string")
		.each(function (key){
			translate(this, key)
			success[key] = false
		})
	else my(globalXML)
	.each(function (i, v) {
 		translate(v, i)
		success[i] = false
	})
	
}

/*
  my.ajax({
	url: "/lb/Root-.xml",
	dataType: "xml"
  })
  .done(function (xml) {
	  my(globalXML = xml).find("dict")
	  .find("string")
	  .each(function (key){
		  translate(this, key)
		  success[key] = false
		  //console.log(key)
	  })
	  
  })*/
  
  function translate (el, i) {
	  var text;
	  if (container.mode === "XML")
	  	text = el.innerHTML
	  else text = el.split("=").slice(1).join("=");

	  my.ajax({
			url: "https://translate.yandex.net/api/v1.5/tr.json/translate",
			type: 'post',
			data: {
				key: keyAPI,
				text: text,
				lang: [container.from, container.to].join("-")
			},
			dataType: "json",
			timeout: 3e4,
			contentType: true,
			successFull: function(e) {
				e = e.text[0]
				if (container.mode === "XML")
					el.innerHTML = e
				else globalXML[i] = el.split("=")[0] + "=" + e;
				success[i] = true
				var r = checkDone()
				if (r === true) {
					container.translated = true
					success = []
				}
				else {
					container.progress = r * 100
				}
			},
			error: function (e) {
				success[i] = true
				//console.log("" + e)
			}
	  })
  }
  
  function checkDone () {
	  var done = true, length = 0, now = 0, status
	  my.each(success, function (key, val) {
			length++
			if (val === false) {
				done = false
				if (status === undefined)
					status = length;
			}
	  })
	  //console.log(status, length)
	  return done || status / length
  }
  //translate()*/
</script>
	<script>window.onerror = function () {  var message = [arguments[0]] + ' at Line: ' + [arguments[2]]; window.webkit.messageHandlers.errorHandler.postMessage(message)};
window.console.log = function() { for(var i = 0; i < arguments.length; i++) window.webkit.messageHandlers.logHandler.postMessage(arguments[i])  }; var sytaxErrorBrnoxProperty = 1;
</script><style> * {
	margin: 0;
	padding: 0;
}
body {
	
} </style> </body>
</html>
